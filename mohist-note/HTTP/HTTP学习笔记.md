# HTTP学习笔记

[TOC]

> [《透视HTTP协议》- 深入理解HTTP协议本质与应用 - 罗剑锋（Chrono）](https://time.geekbang.org/column/article/97837)

## HTTP前世今生

- 1989年，蒂姆·伯纳斯 - 李（Tim Berners-Lee）发表的论文确立了三项关键技术：
  - URI：即统一资源标识符，作为互联网上资源的唯一身份；
  - HTML：即超文本标记语言，描述超文本文档；
  - HTTP：即超文本传输协议，用来传输超文本。
- 20世纪90年代初，`HTTP/0.9`版本诞生，只允许用`“GET”`动作从服务器上获取HTML文档，并且在响应请求之后立即关闭连接，功能非常有限。
- 1996年正式发布`HTTP/1.0`版本，其增加的功能点有：
  - 增加了HEAD、POST等新方法；
  - 增加了响应状态码，标记可能的错误原因；
  - 引入了协议版本号概念；
  - 引入了HTTP Header（头部）的概念，让HTTP处理请求和响应更加灵活；
  - 传输的数据不再仅限于文本。
- 1999年，`HTTP/1.1`发布了RFC文档，编号2616，2014年又修订，编号7230-7235
  - 增加了PUT、DELETE等新方法；
  - 增加了缓存管理和控制；
  - 明确了连接管理，允许持久连接；
  - 允许响应数据分块（chunked），利于传输大文件；
  - 强制要求Host头，让互联网主机托管成为可能。
- 2015年发布`HTTP/2`，RPC编号7540，基于Coogle的`SPDY`协议，主要特点：
  - 二进制协议，不再是纯文本；
  - 可发起多个请求，废弃了1.1里的管道；
  - 使用专用算法压缩头部，减少数据传输量；
  - 允许服务器主动向客户端推送数据；
  - 增强了安全性，“事实上”要求加密通信。
- 2018年互联网标准化组织IETF提议将“HTTP over QUIC”更名为`HTTP/3`，正式进入标准化定制阶段，`QUIC`协议也是Google的。

小结：

1. HTTP协议始于三十年前蒂姆·伯纳斯 - 李的一篇论文；
2. HTTP/0.9是个简单的文本协议，只能获取文本资源；
3. HTTP/1.0确立了大部分现在使用的技术，但他不是正式标准；
4. HTTP/1.1是目前互联网上使用最广泛的协议，功能也非常完善；
5. HTTP/2基于Google的SPDY协议，注重性能改善，但还未普及；
6. HTTP/3基于Google的QUIC协议，是将来的发展方向。

## HTTP是什么？HTTP不是什么？

### HTTP是什么

"**H**pyer**T**ext **T**ransfer **P**rotocol"(超文本传输协议)

- 协议：HTTP是一个用在计算机世界里的协议。它使用计算机能够理解的语言确立了一种计算机之间交流通信的规范，以及相关的各种控制的错误处理方式。（双向协议）
- 传输：HTTP是一个再计算机世界里专门用来在两点之间传输数的约定和规范。
- 超文本：HTTP是一个在计算机世界里专门在两点之间传输文字、图片、音频、视频等超文本数据的约定和规范。

### HTTP不是什么

- HTTP不是互联网；
- HTTP不是编程语言；
- HTTP不是HTML；
- HTTP不是一个孤立的协议。

小结：

1. HTTP是一个用在计算机世界里的协议，它确立了一种计算机之间交流通信的规范，以及相关的各种控制和错误处理方式。
2. HTTP专门用来在两点之间传输数据，不能用于广播、寻址或路由。
3. HTTP传输的是文字、图片、音频、视频等超超文本数据。
4. HTTP是构建互联网的重要基础技术，它没有实体，依赖许多其他的技术来实现，但同时许多技术也都依赖于它。

## HTTP相关的各种概念

小结：

1. 互联网上绝大部分资源都使用HTTP协议传输；
2. 浏览器是HTTP协议里的请求方，即User Agent；
3. 服务器是HTTP协议里的应答方，常用的有Apache和Nginx；
4. CDN位于浏览器和服务器之间，主要起到缓存加速的作用；
5. 爬虫是另一类User Agent，是自动访问网络资源的程序。

## HTTP相关的各种协议

小结:

1. TCP/IP是网络世界最常用的协议，HTTP通常运行在TCP/IP提供的可靠传输基础上；
2. DNS域名是IP地址的等价替代，需要用域名解析实现到IP地址的映射；
3. URI是用来标记互联网上资源的一个名字，由“协议名+主机名+路径”构成，俗称URL；
4. HTTPS相当于“HTTP+SSL/TLS+TCP/IP”，为HTTP套了一个安全的外壳；
5. 代理是HTTP传输过程中的“中转站”，可以实现缓存加速、负载均衡等功能。

## 网络分层

### TCP/IP网络分层模型

![img](https://static001.geekbang.org/resource/image/2b/03/2b8fee82b58cc8da88c74a33f2146703.png)

- 第一层：“**链接层**”（link layer），负责在以太网、WiFi这样的底层网络上发送原始数据包，工作在网卡这个层次，使用MAC地址来标记网络上的设备，所以有时候也叫MAC层。

- 第二层：“**网际层/网络互连层**”（internet layer），IP协议就处在这一层。因为IP协议定义了“IP地址”的概念，所以就可以在“链接层”的基础上，用IP地址取代MAC地址，把许许多多的局域网、广域网连接成一个虚拟的巨大网络，在这个网络里找设备时只要把IP地址再“翻译”成MAC地址就可以了。

- 第三层：“**传输层**”（transport layer），这个层次协议的职责是保证数据在IP地址标记的两点之间“可靠”地传输，是TCP协议工作的曾是，另外还有它的小伙伴UDP。

  > TCP是一个有状态的协议，需要先与对方建立连接然后才能发送数据，而且保证数据不丢失不重复。而UDP是比较简单，它无状态，不用事先建立连接就可以任意发送数据，但不保证数据一定会发到对方。两个协议的另一个重要区别在于数据的形式。TCP的数据是连续的“字节流”，有先后顺序，而UDP则是分散的效数据包，是顺序发，乱序收。

- 第四层：“**应用层**”（application layer），由于下面的三层把基础打得非常好，所以在这一层就“百花齐放”了，有各种面向具体应用的协议。例如Telnet、SSH、FTP、SMTP等等，当然还有HTTP。

MAC层的传输单位是帧（frame），IP层的传输单位是包（packet），TCP层的传输单位是段（segment），HTTP的传输单位则是消息或报文（message）。但这些名词并没有什么本质的区分，可以统称数据包。

### OSI网络分层模型

**OSI**，全称是“**开放式系统互联通信参考模型**”（Open System Interconnection Reference Model）。

![img](https://static001.geekbang.org/resource/image/3a/dc/3abcf1462621ff86758a8d9571c07cdc.png)

- 第一层：物理层，网络的物理形式，例如电缆、光纤、网卡、集线器等等；
- 第二层：数据链路层，它基本相当于TCP/IP的链接层；
- 第三层：网络层，相当于TCP/IP里的网际层；
- 第四层：传输层，相当于TCP/IP里的传输层；
- 第五层：会话层，维护网络中的连接状态，即保持会话和同步；
- 第六层：表示层，把数据转换为合适、可理解的语法和语义；
- 第七层：应用层，面向具体的应用传输数据。

### 两个分层模型的映射关系

![img](https://static001.geekbang.org/resource/image/9d/94/9d9b3c9274465c94e223676b6d434194.png)

- 第一层：物理层，TCP/IP里无对应；
- 第二层：数据链路层，对应TCP/IP的链接层；
- 第三层：网络层，对应TCP/IP的网际层；
- 第四层：传输层，对应TCP/IP的传输层；
- 第五、六、七层：统一对应到TCP/IP的应用层。

### TCP/IP协议栈的工作方式

![img](https://static001.geekbang.org/resource/image/70/6f/70bc19acacf2245fa841349f15cb7a6f.png)

小结:

1. TCP/IP分为四层，核心是二层的IP和三层的TCP，HTTP在第四层；
2. OSI分为七层，基本对应TCP/IP，TCP在第四层，HTTP在第七层；
3. OSI可以映射到TCP/IP，但这期间一、五、六层消失了；
4. 日常交流的时候我们通常使用OSI模型，用四层、七层等术语；
5. HTTP利用TCP/IP协议栈逐层打包再拆包，实现了数据传输，但下面的细节并不可见。

> “**两个凡是**”：凡是由操作系统负责处理的就是四层或四层以下，否则，凡是需要由应用程序（也就是你自己写代码）负责处理的就是七层。

## 域名

小结：

1. 域名使用字符串来代替IP地址，方便用户记忆，本质上一个名字空间系统；
2. DNS就像是我们现实世界里的电话本、查号台，统管着互联网世界里的所有网站，是一个“超级大管家”；
3. DNS是一个树状的分布式查询系统，但为了提高查询效率，外围有多级的缓存；
4. 使用DNS可以实现基于域名的负载均衡，既可以在内网，也可以在外网。

